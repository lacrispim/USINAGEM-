{
  "entities": {
    "MachiningRecord": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MachiningRecord",
      "type": "object",
      "description": "Represents a single machining record with detailed information about the process.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the machining record."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N MachiningRecord). The ID of the user who created this record."
        },
<<<<<<< HEAD
        "material": {
          "type": "string",
          "description": "The material being machined."
        },
        "tool": {
          "type": "string",
          "description": "The cutting tool used for machining."
        },
        "speed": {
=======
        "toolCount": {
>>>>>>> 0319ad85957280a0a0e96ba67c65490ec2d3b8c5
          "type": "number",
          "description": "The cutting speed used in the machining process."
        },
        "feedRate": {
          "type": "number",
          "description": "The feed rate used in the machining process."
        },
        "dateTime": {
          "type": "string",
          "description": "The date and time when the machining record was created.",
          "format": "date-time"
        },
        "notes": {
          "type": "string",
          "description": "Any additional notes or observations about the machining process.",
          "format": "string"
        }
      },
      "required": [
        "id",
        "userId",
        "material",
        "tool",
        "speed",
        "feedRate",
        "dateTime"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Machining Insights application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "email"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Only the authenticated user can read/write their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user. This is the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/machiningRecords/{recordId}",
        "definition": {
          "entityName": "MachiningRecord",
          "schema": {
            "$ref": "#/backend/entities/MachiningRecord"
          },
          "description": "Stores machining records for a specific user. Includes denormalized 'userId' for authorization independence. Only the user with ID '{userId}' can read/write records in this path.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who owns this machining record. This matches the Firebase Auth UID."
            },
            {
              "name": "recordId",
              "description": "The unique identifier for the machining record."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure secure and efficient data management for the Machining Insights application, focusing on user-owned machining records. It leverages path-based ownership to simplify security rules and enhance data isolation.\n\n*   **Authorization Independence:** The `MachiningRecord` documents are stored within user-specific subcollections (`/users/{userId}/machiningRecords/{recordId}`). This inherently ties each record to its owner and avoids any cross-collection `get()` calls for authorization. The `userId` field within each `MachiningRecord` is redundant but explicitly enforces the association and clarifies the intent.\n*   **QAPs (Queries and Permissions):** The structure facilitates secure list operations because access to `/users/{userId}/machiningRecords` is restricted to the authenticated user matching `{userId}`. This prevents unauthorized access to other users' records.\n*   **Structural Segregation:**  All documents within the `/users/{userId}/machiningRecords` collection share the same security posture (owned by the user with ID `{userId}`).\n*   **Predictable Schema:** The schema for `MachiningRecord` is well-defined, and fields such as `userId` are named semantically for clarity.\n*   **Path-Based Ownership:** The design uses hierarchical paths to represent the `User 1:N MachiningRecord` relationship, which provides a clear, secure, and efficient way to manage user-owned data."
  }
}